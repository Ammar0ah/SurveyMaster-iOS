{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar _objectWithoutPropertiesLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutPropertiesLoose\"));\n\nvar _extends5 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _omit2 = _interopRequireDefault(require(\"lodash/omit\"));\n\nvar _isUndefined2 = _interopRequireDefault(require(\"lodash/isUndefined\"));\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _schemaTyped = require(\"schema-typed\");\n\nvar _classnames = _interopRequireDefault(require(\"classnames\"));\n\nvar _utils = require(\"../utils\");\n\nvar _prefix = require(\"../utils/prefix\");\n\nvar Form =\n/*#__PURE__*/\nfunction (_React$Component) {\n  (0, _inheritsLoose2.default)(Form, _React$Component);\n\n  function Form(props) {\n    var _this;\n\n    _this = _React$Component.call(this, props) || this;\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"check\", function (callback) {\n      var formValue = _this.getFormValue() || {};\n      var _this$props = _this.props,\n          model = _this$props.model,\n          onCheck = _this$props.onCheck,\n          onError = _this$props.onError;\n      var formError = {};\n      var errorCount = 0;\n      Object.keys(model.schema).forEach(function (key) {\n        var checkResult = model.checkForField(key, formValue[key], formValue);\n\n        if (checkResult.hasError === true) {\n          errorCount += 1;\n          formError[key] = checkResult.errorMessage;\n        }\n      });\n\n      _this.setState({\n        formError: formError\n      });\n\n      onCheck && onCheck(formError);\n      callback && callback(formError);\n\n      if (errorCount > 0) {\n        onError && onError(formError);\n        return false;\n      }\n\n      return true;\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"checkForField\", function (fieldName, callback) {\n      var _extends2;\n\n      var formValue = _this.getFormValue() || {};\n      var _this$props2 = _this.props,\n          model = _this$props2.model,\n          onCheck = _this$props2.onCheck,\n          onError = _this$props2.onError;\n      var checkResult = model.checkForField(fieldName, formValue[fieldName], formValue);\n      var formError = (0, _extends5.default)({}, _this.getFormError(), (_extends2 = {}, _extends2[fieldName] = checkResult.errorMessage, _extends2));\n      onCheck && onCheck(formError);\n      callback && callback(checkResult);\n\n      if (checkResult.hasError) {\n        onError && onError(formError);\n        return false;\n      }\n\n      return true;\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"handleFieldError\", function (name, errorMessage) {\n      var _extends3;\n\n      var _this$props3 = _this.props,\n          onError = _this$props3.onError,\n          onCheck = _this$props3.onCheck;\n      var formError = (0, _extends5.default)({}, _this.state.formError, (_extends3 = {}, _extends3[name] = errorMessage, _extends3));\n\n      _this.setState({\n        formError: formError\n      }, function () {\n        onError && onError(formError);\n        onCheck && onCheck(formError);\n      });\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"handleFieldSuccess\", function (name) {\n      var onCheck = _this.props.onCheck;\n      var formError = (0, _omit2.default)(_this.state.formError, [name]);\n\n      _this.setState({\n        formError: formError\n      }, function () {\n        onCheck && onCheck(formError);\n      });\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"handleFieldChange\", function (name, value, event) {\n      var _extends4;\n\n      var onChange = _this.props.onChange;\n\n      var formValue = _this.getFormValue();\n\n      var nextFormValue = (0, _extends5.default)({}, formValue, (_extends4 = {}, _extends4[name] = value, _extends4));\n\n      _this.setState({\n        formValue: nextFormValue\n      });\n\n      onChange && onChange(nextFormValue, event);\n    });\n    _this.state = {\n      formError: props.formError || {},\n      formValue: props.formDefaultValue\n    };\n    return _this;\n  }\n\n  var _proto = Form.prototype;\n\n  _proto.getChildContext = function getChildContext() {\n    var _this$props4 = this.props,\n        formDefaultValue = _this$props4.formDefaultValue,\n        formValue = _this$props4.formValue,\n        model = _this$props4.model,\n        checkTrigger = _this$props4.checkTrigger,\n        errorFromContext = _this$props4.errorFromContext;\n    var formError = this.getFormError();\n    return {\n      form: {\n        onFieldChange: this.handleFieldChange,\n        onFieldError: this.handleFieldError,\n        onFieldSuccess: this.handleFieldSuccess,\n        checkTrigger: checkTrigger,\n        formValue: formValue,\n        formDefaultValue: formDefaultValue,\n        formError: formError,\n        model: model,\n        errorFromContext: errorFromContext\n      }\n    };\n  };\n\n  _proto.getFormValue = function getFormValue() {\n    var formValue = this.props.formValue;\n    return (0, _isUndefined2.default)(formValue) ? this.state.formValue : formValue;\n  };\n\n  _proto.getFormError = function getFormError() {\n    var formError = this.props.formError;\n    return (0, _isUndefined2.default)(formError) ? this.state.formError : formError;\n  }\n  /**\n   * public APIs\n   */\n  ;\n  /**\n   * public APIs\n   */\n\n\n  _proto.cleanErrors = function cleanErrors(callback) {\n    this.setState({\n      formError: {}\n    }, callback);\n  }\n  /**\n   * public APIs\n   */\n  ;\n\n  _proto.resetErrors = function resetErrors(formError, callback) {\n    if (formError === void 0) {\n      formError = {};\n    }\n\n    this.setState({\n      formError: formError\n    }, callback);\n  };\n\n  _proto.render = function render() {\n    var _this$props5 = this.props,\n        layout = _this$props5.layout,\n        classPrefix = _this$props5.classPrefix,\n        fluid = _this$props5.fluid,\n        className = _this$props5.className,\n        props = (0, _objectWithoutPropertiesLoose2.default)(_this$props5, [\"layout\", \"classPrefix\", \"fluid\", \"className\"]);\n    var addPrefix = (0, _utils.prefix)(classPrefix);\n    var classes = (0, _classnames.default)(classPrefix, addPrefix(layout), className, addPrefix(fluid && layout === 'vertical' ? 'fluid' : 'fixed-width'));\n    var unhandled = (0, _utils.getUnhandledProps)(Form, props);\n    return React.createElement(\"form\", (0, _extends5.default)({}, unhandled, {\n      onSubmit: function onSubmit(e) {\n        return e.preventDefault();\n      },\n      className: classes\n    }));\n  };\n\n  return Form;\n}(React.Component);\n\n(0, _defineProperty2.default)(Form, \"defaultProps\", {\n  classPrefix: (0, _prefix.defaultClassPrefix)('form'),\n  model: (0, _schemaTyped.SchemaModel)({}),\n  layout: 'vertical',\n  formDefaultValue: {},\n  checkDelay: 500,\n  checkTrigger: 'change',\n  errorFromContext: true\n});\n(0, _defineProperty2.default)(Form, \"childContextTypes\", {\n  form: _propTypes.default.object.isRequired\n});\n(0, _defineProperty2.default)(Form, \"handledProps\", [\"checkDelay\", \"checkTrigger\", \"className\", \"classPrefix\", \"errorFromContext\", \"fluid\", \"formDefaultValue\", \"formError\", \"formValue\", \"layout\", \"model\", \"onChange\", \"onCheck\", \"onError\"]);\nvar _default = Form;\nexports.default = _default;","map":null,"metadata":{},"sourceType":"script"}