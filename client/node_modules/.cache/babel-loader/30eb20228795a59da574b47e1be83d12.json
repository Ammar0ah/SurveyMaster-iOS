{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.default = void 0;\n\nvar _objectWithoutPropertiesLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutPropertiesLoose\"));\n\nvar _extends5 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _omit2 = _interopRequireDefault(require(\"lodash/omit\"));\n\nvar _isUndefined2 = _interopRequireDefault(require(\"lodash/isUndefined\"));\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _schemaTyped = require(\"schema-typed\");\n\nvar _classnames = _interopRequireDefault(require(\"classnames\"));\n\nvar _utils = require(\"rsuite-utils/lib/utils\");\n\nvar _utils2 = require(\"./utils\");\n\nvar _prefix = require(\"./utils/prefix\");\n\nvar _FormContext = _interopRequireWildcard(require(\"./FormContext\"));\n\nvar _Form = _interopRequireDefault(require(\"./_legacy/Form\"));\n\nfunction preventDefaultEvent(event) {\n  event.preventDefault();\n}\n\nvar Form =\n/*#__PURE__*/\nfunction (_React$Component) {\n  (0, _inheritsLoose2.default)(Form, _React$Component);\n\n  function Form(_props) {\n    var _this;\n\n    _this = _React$Component.call(this, _props) || this;\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"formContextValue\", null);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"getFormValue\", function (state, props) {\n      if (state === void 0) {\n        state = _this.state;\n      }\n\n      if (props === void 0) {\n        props = _this.props;\n      }\n\n      return (0, _isUndefined2.default)(props.formValue) ? state.formValue : props.formValue;\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"getFormError\", function (state, props) {\n      if (state === void 0) {\n        state = _this.state;\n      }\n\n      if (props === void 0) {\n        props = _this.props;\n      }\n\n      return (0, _isUndefined2.default)(props.formError) ? state.formError : props.formError;\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"check\", function (callback) {\n      var formValue = _this.getFormValue() || {};\n      var _this$props = _this.props,\n          model = _this$props.model,\n          onCheck = _this$props.onCheck,\n          onError = _this$props.onError;\n      var formError = {};\n      var errorCount = 0;\n      Object.keys(model.schema).forEach(function (key) {\n        var checkResult = model.checkForField(key, formValue[key], formValue);\n\n        if (checkResult.hasError === true) {\n          errorCount += 1;\n          formError[key] = checkResult.errorMessage;\n        }\n      });\n\n      _this.setState({\n        formError: formError\n      });\n\n      onCheck && onCheck(formError);\n      callback && callback(formError);\n\n      if (errorCount > 0) {\n        onError && onError(formError);\n        return false;\n      }\n\n      return true;\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"checkForField\", function (fieldName, callback) {\n      var formValue = _this.getFormValue() || {};\n      var _this$props2 = _this.props,\n          model = _this$props2.model,\n          onCheck = _this$props2.onCheck,\n          onError = _this$props2.onError;\n      var checkResult = model.checkForField(fieldName, formValue[fieldName], formValue);\n\n      _this.setState(function (prvState, props) {\n        var _extends2;\n\n        var formError = (0, _extends5.default)({}, _this.getFormError(prvState, props), (_extends2 = {}, _extends2[fieldName] = checkResult.errorMessage, _extends2));\n        onCheck && onCheck(formError);\n        checkResult.hasError && onError && onError(formError);\n        return {\n          formError: formError\n        };\n      });\n\n      callback && callback(checkResult);\n      return !checkResult.hasError;\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"handleFieldError\", function (name, errorMessage) {\n      var _this$props3 = _this.props,\n          onError = _this$props3.onError,\n          onCheck = _this$props3.onCheck;\n\n      _this.setState(function (prvState, props) {\n        var _extends3;\n\n        var formError = (0, _extends5.default)({}, _this.getFormError(prvState, props), (_extends3 = {}, _extends3[name] = errorMessage, _extends3));\n        onError && onError(formError);\n        onCheck && onCheck(formError);\n        return {\n          formError: formError\n        };\n      });\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"handleFieldSuccess\", function (name) {\n      var onCheck = _this.props.onCheck;\n\n      _this.setState(function (prvState, props) {\n        var formError = (0, _omit2.default)(_this.getFormError(prvState, props), [name]);\n        onCheck && onCheck(formError);\n        return {\n          formError: formError\n        };\n      });\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"handleFieldChange\", function (name, value, event) {\n      var _extends4;\n\n      var onChange = _this.props.onChange;\n\n      var formValue = _this.getFormValue();\n\n      var nextFormValue = (0, _extends5.default)({}, formValue, (_extends4 = {}, _extends4[name] = value, _extends4));\n\n      _this.setState({\n        formValue: nextFormValue\n      });\n\n      onChange && onChange(nextFormValue, event);\n    });\n    var _this$props4 = _this.props,\n        formDefaultValue = _this$props4.formDefaultValue,\n        _formError = _this$props4.formError;\n    _this.state = {\n      formError: _formError || {},\n      formValue: formDefaultValue\n    };\n    return _this;\n  }\n\n  var _proto = Form.prototype;\n  /**\n   * public APIs\n   */\n\n  _proto.cleanErrors = function cleanErrors(callback) {\n    this.setState({\n      formError: {}\n    }, callback);\n  }\n  /**\n   * public APIs\n   */\n  ;\n\n  _proto.cleanErrorForFiled = function cleanErrorForFiled(fieldName, callback) {\n    this.setState({\n      formError: (0, _omit2.default)(this.state.formError, [fieldName])\n    }, callback);\n  }\n  /**\n   * public APIs\n   */\n  ;\n\n  _proto.resetErrors = function resetErrors(formError, callback) {\n    if (formError === void 0) {\n      formError = {};\n    }\n\n    this.setState({\n      formError: formError\n    }, callback);\n  };\n\n  _proto.getFormContextValue = function getFormContextValue() {\n    var _this$props5 = this.props,\n        formDefaultValue = _this$props5.formDefaultValue,\n        errorFromContext = _this$props5.errorFromContext,\n        model = _this$props5.model,\n        checkTrigger = _this$props5.checkTrigger;\n    var nextFormContextValue = {\n      model: model,\n      checkTrigger: checkTrigger,\n      formDefaultValue: formDefaultValue,\n      errorFromContext: errorFromContext,\n      onFieldChange: this.handleFieldChange,\n      onFieldError: this.handleFieldError,\n      onFieldSuccess: this.handleFieldSuccess\n    };\n\n    if (!(0, _utils.shallowEqual)(nextFormContextValue, this.formContextValue)) {\n      this.formContextValue = nextFormContextValue;\n    }\n\n    return this.formContextValue;\n  };\n\n  _proto.checkErrorFromContext = function checkErrorFromContext(children) {\n    var errorFromContext = this.props.errorFromContext;\n\n    if (errorFromContext) {\n      var _formError2 = this.getFormError();\n\n      return React.createElement(_FormContext.FormErrorContext.Provider, {\n        value: _formError2\n      }, children);\n    }\n\n    return children;\n  };\n\n  _proto.render = function render() {\n    var _this$props6 = this.props,\n        _this$props6$formValu = _this$props6.formValue,\n        formValue = _this$props6$formValu === void 0 ? {} : _this$props6$formValu,\n        layout = _this$props6.layout,\n        classPrefix = _this$props6.classPrefix,\n        fluid = _this$props6.fluid,\n        className = _this$props6.className,\n        children = _this$props6.children,\n        props = (0, _objectWithoutPropertiesLoose2.default)(_this$props6, [\"formValue\", \"layout\", \"classPrefix\", \"fluid\", \"className\", \"children\"]);\n    var addPrefix = (0, _utils2.prefix)(classPrefix);\n    var classes = (0, _classnames.default)(classPrefix, className, addPrefix(layout), addPrefix(fluid && layout === 'vertical' ? 'fluid' : 'fixed-width'));\n    var unhandled = (0, _utils2.getUnhandledProps)(Form, props);\n    var contextDefalutValue = this.getFormContextValue();\n    return React.createElement(\"form\", (0, _extends5.default)({\n      onSubmit: preventDefaultEvent\n    }, unhandled, {\n      className: classes\n    }), React.createElement(_FormContext.default.Provider, {\n      value: contextDefalutValue\n    }, React.createElement(_FormContext.FormValueContext.Provider, {\n      value: formValue\n    }, this.checkErrorFromContext(children))));\n  };\n\n  return Form;\n}(React.Component);\n\n(0, _defineProperty2.default)(Form, \"defaultProps\", {\n  classPrefix: (0, _prefix.defaultClassPrefix)('form'),\n  model: (0, _schemaTyped.SchemaModel)({}),\n  layout: 'vertical',\n  formDefaultValue: {},\n  checkDelay: 500,\n  checkTrigger: 'change',\n  errorFromContext: true\n});\n(0, _defineProperty2.default)(Form, \"handledProps\", [\"checkDelay\", \"checkTrigger\", \"children\", \"className\", \"classPrefix\", \"errorFromContext\", \"fluid\", \"formDefaultValue\", \"formError\", \"formValue\", \"layout\", \"model\", \"onChange\", \"onCheck\", \"onError\"]);\n\nvar _default = React.createContext ? Form : _Form.default;\n\nexports.default = _default;","map":null,"metadata":{},"sourceType":"script"}